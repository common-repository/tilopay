(()=>{var e={704:()=>{function e(e){let t=window.location.origin+window.location.pathname;if(window.history.replaceState({},document.title,t),!document.getElementById("tilopay_response_error_div")){var n=`\n  <div class="wc-block-components-notices wc-block-components-notices-tilopay" id="tilopay_response_error_div">\n      <div class="wc-block-store-notice wc-block-components-notice-banner is-error is-dismissible">\n          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">\n              <path d="M12 3.2c-4.8 0-8.8 3.9-8.8 8.8 0 4.8 3.9 8.8 8.8 8.8 4.8 0 8.8-3.9 8.8-8.8 0-4.8-4-8.8-8.8-8.8zm0 16c-4 0-7.2-3.3-7.2-7.2C4.8 8 8 4.8 12 4.8s7.2 3.3 7.2 7.2c0 4-3.2 7.2-7.2 7.2zM11 17h2v-6h-2v6zm0-8h2V7h-2v2z"></path>\n          </svg>\n          <div class="wc-block-components-notice-banner__content">\n              <div id="tilopay_response_error">Error: ${e}</div>\n          </div>\n          <button type="button" class="components-button wc-block-components-button wp-element-button wc-block-components-notice-banner__dismiss contained has-text has-icon" onClick="closeTilopayErrorMessage(this)">\n              <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">\n                  <path d="M13 11.8l6.1-6.3-1-1-6.1 6.2-6.1-6.2-1 1 6.1 6.3-6.5 6.7 1 1 6.5-6.6 6.5 6.6 1-1z"></path>\n              </svg>\n              <span class="wc-block-components-button__text"></span>\n          </button>\n      </div>\n  </div>\n  `;document.querySelector('div[data-block-name="woocommerce/checkout"]').insertAdjacentHTML("afterbegin",n)}}jQuery(document).ready((function(t){let n=new URLSearchParams(window.location.search),a=n.get("returnData"),o=n.get("description"),l=n.get("message_error");if(o?e(o):l&&e(l),"tilopay"==a){var r=window.location.origin+window.location.pathname;history.replaceState(null,null,r),function(){if(!document.getElementById("tilopay-m1")){var e=document.createElement("div");e.id="tilopay-m1",e.className="tilopay-modal-container active";var t=document.createElement("div");t.className="tilopay-overlay",t.setAttribute("data-modal","close");var n=document.createElement("div");n.id="spinner_Tilopay",n.className="spinner_Tilopay",e.appendChild(t),e.appendChild(n),document.body.appendChild(e),".spinner_Tilopay {     border: 16px solid #f3f3f3;     border-top: 16px solid #ff3644;     border-radius: 50%;     width: 90px;     height: 90px;     animation: spin 2s linear infinite;     position: fixed;     top: 50%;     left: 50%;     transform: translate(-50%, -50%);     z-index: 9999;   }     @keyframes spin {     0% { transform: rotate(0deg); }     100% { transform: rotate(360deg); }   }",(a=document.createElement("style")).type="text/css",a.appendChild(document.createTextNode(".spinner_Tilopay {     border: 16px solid #f3f3f3;     border-top: 16px solid #ff3644;     border-radius: 50%;     width: 90px;     height: 90px;     animation: spin 2s linear infinite;     position: fixed;     top: 50%;     left: 50%;     transform: translate(-50%, -50%);     z-index: 9999;   }     @keyframes spin {     0% { transform: rotate(0deg); }     100% { transform: rotate(360deg); }   }")),document.head.appendChild(a)}var a}(),setTimeout((()=>{document.querySelector("#radio-control-wc-payment-method-options-tilopay").click(),function(){var e=document.getElementById("spinner_Tilopay");e&&e.parentNode.removeChild(e);let t=document.getElementById("tilopay-m1");t&&t.parentNode.removeChild(t)}()}),1e3)}}))}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,n),l.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=window.React;var t=n.n(e);const a=window.wp.i18n,o=window.wc.wcBlocksRegistry,l=window.wp.htmlEntities,r=window.wc.wcSettings;n(704);const i=({initSdkSettings:t,sdkInitResponse:n,selectedPaymentMethod:o,setSelectedPaymentMethod:l,paymentData:r,setPaymentData:i,checkoutData:s,setPaymentError:c,paymentError:p,activeModal:d,setActiveModal:u})=>{const[m,y]=(0,e.useState)([]);(0,e.useEffect)((()=>{const e=n.methods.find((e=>1===e.apple_pay)),t=e?{...e,name:"Apple Pay",id:e.id+"_applepay",type:"applepay"}:null;t&&v(t);const a=t?[...n.methods,t]:n.methods;a.length>0&&(1==a.length&&v(a[0]),y(a))}),[n]);const v=e=>{"sinpemovil"===e.type&&(c(void 0),t.have_order_id&&u(!0));const a=e.id.split(":"),o=a.length>1&&"4"==a[1]?a[2]:"";i((t=>({...t,tlpy_payment_method:e.id,pay_sinpemovil_tilopay:"sinpemovil"===e.type&&"PROD"==n.environment&&"4"==a[1],tlpy_sinpemovil_number:o,tpay_env:n.environment,tpay_can_make_payment:"1"!=a[1]}))),l(e)};return(0,e.createElement)(e.Fragment,null,m.length>0?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{style:1==m.length?{display:"none"}:{display:"block"}},void 0!==o&&"applepay"===o.type&&(0,e.createElement)("input",{type:"hidden",id:"tlpy_apple_pay_cancel",value:""}),(0,e.createElement)("label",{htmlFor:"tlpy_payment_method",id:"methodLabel"},(0,a.__)("Payment methods","tilopay")),(0,e.createElement)("select",{name:"tlpy_payment_method",id:"tlpy_payment_method",className:"select wc-credit-card-form-card-select",onChange:({target:e})=>{const{value:t}=e,n=m.find((e=>e.id===t));v(n)},style:{height:50},value:void 0!==o?o.id:""},(0,e.createElement)("option",{value:"",desabled:"true"},(0,a.__)("Select payment method","tilopay")),m.map(((t,n)=>{let o=!s.have_subscription||"sinpemovil"!==t.type&&"applepay"!==t.type?null:"disabled";return(0,e.createElement)("option",{key:n,value:t.id,disabled:o},t.name," ",!s.have_subscription||"sinpemovil"!==t.type&&"applepay"!==t.type?"":(0,a.__)("Disabled for subscriptions","tilopay"))}))))):0===m.length&&(0,e.createElement)("div",{className:"woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout",id:"tpay-sdk-error-div",style:{opacity:1}},(0,e.createElement)("ul",{className:"woocommerce-error",role:"alert",id:"tpay-sdk-error"},(0,e.createElement)("li",{className:"error-sdk-li"},(0,a.__)("There seems to be an issue with this website's integration with Tilopay, please inform the seller to complete your purchase.","tilopay")))))},s=window.wc.blocksCheckout,c=window.wp.data;var p=function(e,t){var n,a;e=e.toString();for(var o=t.rules,l=t.generateMask(e),r=t.transform,i=e.length,s=l.length,c=0,p="",d=0;d<Math.min(i,s);d++){var u=l.charAt(d),m=e.charAt(c),y=o.get(u);y?(c++,y.test(m)?p+=m:(d--,i--)):(u===m?c++:i++,p+=u)}var v=0;if(r){var _=p;v=(null!==(n=null==(p=r(_))?void 0:p.length)&&void 0!==n?n:0)-(null!==(a=null==_?void 0:_.length)&&void 0!==a?a:0)}return{maskedValue:p,mask:l,transformOffset:v}},d=function(e,t){var n;if(!t)return e;var a=t.rules,o=t.generateMask(e),l=null!==(n=null==o?void 0:o.length)&&void 0!==n?n:0;return e.split("").filter((function(e,t){return t<l&&a.has(o[t])})).join("")};const u={getExpectedCursorPos:function(e){var t,n,a,o,l,r,i,s,c,p,d,u,m,y,v,_,h,f,g,b,k,_x,w,E,x,C,M=e.displayValue,S=e.oldDisplayValue,P=e.valueBeforeMask,T=e.newMask,N=e.oldMask,R=e.cursorPosition,D=e.lastWentBack,V=null!==(t=null==N?void 0:N.generateMask(S))&&void 0!==t?t:"",A=null!==(n=null==T?void 0:T.generateMask(M))&&void 0!==n?n:"",O=V.split("").filter((function(e,t){return(null==S?void 0:S[t])&&(!N||N.rules.has(e))})).length,I=A.split("").filter((function(e,t){return(null==M?void 0:M[t])&&(!T||T.rules.has(e))})).length;if(O===I&&M===S){var B=null!==(a=null==M?void 0:M.length)&&void 0!==a?a:0,F=null!==(o=null==P?void 0:P.length)&&void 0!==o?o:0;if(B>F){for(var z=R+B-F,j=!0,G=!D,L=0;j;){var U=(ie=z+L+(G?-1:0))>=0&&ie<(null!==(l=null==A?void 0:A.length)&&void 0!==l?l:0)?null==A?void 0:A.charAt(ie):void 0;U?(null===(r=null==T?void 0:T.rules)||void 0===r?void 0:r.get(U))?j=!1:L=G?L-1:L+1:j=!1}return{position:Math.max(Math.min(z+L,null!==(i=null==M?void 0:M.length)&&void 0!==i?i:0),0),wentBack:G}}if(B<F){var W={ignored:0,idx:0},$=(null!==(u=null===(d=null===(p=null==P?void 0:P.substring(0,Math.min(null!==(s=null==P?void 0:P.length)&&void 0!==s?s:0,null!==(c=null==A?void 0:A.length)&&void 0!==c?c:0,R)))||void 0===p?void 0:p.split(""))||void 0===d?void 0:d.reduce((function(e,t){for(var n,a,o=e.ignored,l=e.idx,r=null!==(n=null==A?void 0:A.length)&&void 0!==n?n:0;l<r;){if(l>=R)return e;var i=null==A?void 0:A.charAt(l),s=null===(a=null==T?void 0:T.rules)||void 0===a?void 0:a.get(i);if(s)return s.test(t)?{ignored:o,idx:l+1}:{ignored:o+1,idx:l};if(i===t)return{ignored:o,idx:l+1};l++}return{ignored:o,idx:l+1}}),W))&&void 0!==u?u:W).ignored;return{position:Math.max(Math.min(R-$,null!==(m=null==M?void 0:M.length)&&void 0!==m?m:0),0),wentBack:D}}return{position:R,wentBack:D}}if(O<=I){for(var q=I-O,H=Math.max(Math.min(R-q,null!==(y=null==S?void 0:S.length)&&void 0!==y?y:0),0),K=null==V?void 0:V.substring(0,Math.max(H,0)).split("").filter((function(e,t){return(null==S?void 0:S[t])&&!!N&&!N.rules.has(e)})).length,Y=null==A?void 0:A.substring(0,Math.max(H,0)).split("").filter((function(e,t){return(null==M?void 0:M[t])&&!!T&&!T.rules.has(e)})).length,Z=Y-K,J=Math.max((null!==(v=null==P?void 0:P.length)&&void 0!==v?v:0)-(null!==(_=null==M?void 0:M.length)&&void 0!==_?_:0),0),Q=(W={ignored:0,exceeded:0,staticAdded:0,idx:0},null!==(f=null===(h=null==P?void 0:P.split(""))||void 0===h?void 0:h.reduce((function(e,t){for(var n,a,o=e.ignored,l=e.exceeded,r=e.staticAdded,i=e.idx,s=null!==(n=null==A?void 0:A.length)&&void 0!==n?n:0;i<s;){var c,p=null==A?void 0:A.charAt(i),d=null===(a=null==T?void 0:T.rules)||void 0===a?void 0:a.get(p);if(d)return d.test(t)?{ignored:o,exceeded:l,staticAdded:r,idx:i+1}:{ignored:c=i>H+Z-J&&i<R?o+1:o,exceeded:l,staticAdded:!c&&i<R?r-1:r,idx:i};if(p===t)return{ignored:c=i>H+Z-J&&i<R?o+1:o,exceeded:l,staticAdded:r,idx:i+1};i<R&&(r+=1),i++}return{ignored:o,exceeded:l+1,staticAdded:r,idx:i+1}}),W))&&void 0!==f?f:W),X=Q.ignored,ee=void 0===X?0:X,te=Q.exceeded,ne=void 0===te?0:te,ae=Q.staticAdded,oe=void 0===ae?0:ae,le=H,re=Z;le-re-ne<H+q;){var ie;if((ie=le-ne)<0)le++;else{var se=null==A?void 0:A[ie];if(!se)break;(ce=!T||T.rules.has(se))||re++,le++}}return re=Math.max(oe,re,0),{position:Math.min(R+re-ee,null!==(g=null==A?void 0:A.length)&&void 0!==g?g:0),wentBack:D}}L=null!==(w=null===(_x=null===(k=null==P?void 0:P.substring(0,Math.min(R,null!==(b=null==P?void 0:P.length)&&void 0!==b?b:0)))||void 0===k?void 0:k.split(""))||void 0===_x?void 0:_x.reduce((function(e,t,n){var a,o=null==A?void 0:A[n],l=null===(a=null==T?void 0:T.rules)||void 0===a?void 0:a.get(o);return l?l.test(t)?e:e-1:o===t?e:e+1}),0))&&void 0!==w?w:0,W={dynamic:0,idx:0};var ce=(null!==(x=null===(E=null==P?void 0:P.split(""))||void 0===E?void 0:E.reduce((function(e,t){for(var n,a,o=e.dynamic,l=e.idx,r=null!==(n=null==A?void 0:A.length)&&void 0!==n?n:0;l<r;){var i=null==A?void 0:A[l],s=null===(a=null==T?void 0:T.rules)||void 0===a?void 0:a.get(i);if(s)return s.test(t)?{dynamic:o+1,idx:l+1}:e;if(i===t)return{dynamic:o,idx:l+1};l++}return e}),W))&&void 0!==x?x:W).dynamic;return q=Math.max(I-ce,0),{position:z=Math.max(Math.min(R+L+q,null!==(C=null==M?void 0:M.length)&&void 0!==C?C:0),0),wentBack:D}},mask:function(e,t){var n=p(e,t),a=n.maskedValue,o=n.mask,l=n.transformOffset,r=p(null!=a?a:"",t),i=r.maskedValue,s=r.mask;return a!==i?("undefined"!=typeof console&&(null===console||void 0===console||console.error("mask applied to value should not change when applied again","-> before: "+e,"-> after: "+a+" (mask: "+o+")","-> again: "+i+" (mask: "+s+")")),{maskedValue:e,mask:o,transformOffset:0}):{maskedValue:a,mask:o,transformOffset:l}},processValue:function(e,t){return t.keepMask?e:d(e,t)},unmask:d};var m=new Map([["A",/[A-Za-z]/],["9",/\d/],["?",/\w/]]),y=function(e){return{rules:m,generateMask:function(){return e}}},v=u.getExpectedCursorPos,_=u.mask,h=u.processValue,f=function(){return f=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},f.apply(this,arguments)},g=t().forwardRef((function(e,n){var a=e.maskGenerator,o=e.value,l=e.onChange,r=e.keepMask,i=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(n[a[o]]=e[a[o]])}return n}(e,["maskGenerator","value","onChange","keepMask"]),s=function(e){var n=e.maskGenerator,a=e.value,o=e.onChange,l=e.keepMask,r=e.ref,i=t().useCallback((function(e){var t;return null!==(t=null==e?void 0:e.selectionStart)&&void 0!==t?t:0}),[]),s=function(e){var n,a,o=e.maskGenerator,l=e.value,r=e.onChange,i=e.keepMask,s=e.ref,c=e.getCursorPosition,p=e.setCursorPosition,d=(n=t().useRef(null),a=s,t().useEffect((function(){[n,a].forEach((function(e){e&&("function"==typeof e?e(n.current||null):e.current=n.current||null)}))}),[n,a]),n),u=function(e){var n,a=e.outerValue,o=e.maskGenerator,l=e.onChange,r=e.getCursorPosition,i=e.setCursorPosition,s=e.keepMask,c=t().useRef(a),p=t().useRef(a),d=t().useRef(a),u=t().useRef(null!==(n=null==a?void 0:a.length)&&void 0!==n?n:0),m=t().useRef(a),y=t().useRef(!1),f=t().useRef(o),g=t().useRef(o),b=t().useState(a),k=b[0],w=b[1],E=t().useState(k),x=E[0],C=E[1],M=t().useState(x),S=M[0],P=M[1],T=t().useState(),N=T[0],R=T[1],D=t().useState(!1),V=D[0],A=D[1],O=t().useCallback((function(e,t){if(t&&r){if(e&&o){var n=r(),a=n<=(null==e?void 0:e.length)?null==e?void 0:e.substring(n):void 0;if(a){for(var l="",i=0,s=null==(b=o.generateMask(e))?void 0:b.charAt(i);s&&!o.rules.has(s);)l+=s,i++,s=null==b?void 0:b.charAt(i);if(l){for(var p="",d=l;d&&e.startsWith(p)&&!a.startsWith(d);)p+=null==d?void 0:d.charAt(0),d=d.substring(1);d&&e.startsWith(p)&&a.startsWith(d)&&(e=e.substring(0,n)+e.substring(n+d.length))}}}var y=r();u.current=y,m.current=e,A(!0)}if(""===(null!=e?e:"").trim())return C(""),w(""),f.current=void 0,c.current="",{displayValue:""};if(o){var v=_(e,o),g=v.maskedValue,b=v.mask,k=v.transformOffset,E=h(null!=g?g:"",o);if(C(null!=g?g:void 0),w(null!=E?E:void 0),f.current=o,c.current=null!=E?E:void 0,k&&t&&r){var x=(y=r())+k;u.current=x,m.current=e,A(!0)}return{displayValue:g,mask:b}}return C(e),w(e),f.current=void 0,c.current=null!=e?e:void 0,{displayValue:e}}),[o,r]),I=t().useCallback((function(e){var t,n=e.displayValue,a=e.oldDisplayValue,o=e.newMask,l=e.oldMask,s=e.force;if(i&&r){var c=v({displayValue:n,oldDisplayValue:a,valueBeforeMask:null!==(t=m.current)&&void 0!==t?t:"",newMask:o,oldMask:l,cursorPosition:u.current,lastWentBack:y.current}),p=c.position,d=c.wentBack,_=void 0!==d&&d;(s||u.current!==p)&&(u.current=p,i(p)),y.current=_}}),[i,r]);t().useEffect((function(){var e=(null==o?void 0:o.generateMask)&&(null==o?void 0:o.generateMask(null!=k?k:""))||void 0;e===N&&a===c.current||(R(e),c.current=a,e===N&&a===k||O(null!=a?a:""))}),[N,R,o,a,k,O]),t().useEffect((function(){k!==p.current&&(p.current=k,O(null!=k?k:""),!s&&l&&l(null!=k?k:""))}),[k,o,O,s,l]),t().useEffect((function(){if(x!==d.current){var e=O(null!=x?x:"").displayValue;(null!=e?e:"")===(null!=x?x:"")&&(d.current=null!=e?e:void 0,s&&l&&l(null!=e?e:""))}}),[x,O,s,l]),t().useEffect((function(){var e,t=(r?r():u.current)!==u.current;x===d.current&&(S!==d.current||t||V)&&(A(!1),P(d.current),g.current=f.current,I({displayValue:null!==(e=d.current)&&void 0!==e?e:"",oldDisplayValue:null!=S?S:"",newMask:f.current,oldMask:g.current,force:t}))}),[S,x,V,r,I]);var B=t().useMemo((function(){return{displayValue:x,setDisplayValue:function(e){O(e,!0)}}}),[x,O]);return B}({outerValue:l,maskGenerator:o,getCursorPosition:t().useCallback((function(){var e=null==d?void 0:d.current;return c(null!=e?e:void 0)}),[d,c]),setCursorPosition:t().useCallback((function(e){var t=null==d?void 0:d.current;p(e,null!=t?t:void 0)}),[d,p]),onChange:r,keepMask:i});return{displayValue:u.displayValue,setDisplayValue:u.setDisplayValue,ref:d}}({value:a,maskGenerator:n,getCursorPosition:i,setCursorPosition:t().useCallback((function(e,t){t&&(t.selectionStart=e,t.selectionEnd=e)}),[]),onChange:o,keepMask:l,ref:r}),c=s.displayValue,p=s.setDisplayValue,d=s.ref,u=t().useCallback((function(e){var t,n;return p(null!==(n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)&&void 0!==n?n:"")}),[p]);return{value:c,onChange:u,ref:d}}({maskGenerator:a,value:null!=o?"".concat(o):void 0,onChange:l,keepMask:r,ref:n});return t().createElement("input",f({},i,s))}));const b=({paymentData:t,setPaymentData:n,checkoutData:o,setPaymentError:l,paymentError:r,sdkInitResponse:i})=>{const[p,d]=(0,e.useState)(!1),[u,m]=(0,e.useState)(!1),[v,_]=(0,e.useState)(!1),[h,f]=(0,e.useState)(!1),{setValidationErrors:b,clearValidationError:k}=(0,c.useDispatch)("wc/store/validation"),[w,E]=(0,e.useState)([]),[x,C]=(0,e.useState)("flat_icon_tilopay.png"),[M,S]=(0,e.useState)([]),[P,T]=(0,e.useState)(0===w.length?"":"newCard");(0,e.useEffect)((()=>{i.methods.length>0&&E(i.cards)}),[i]),(0,e.useEffect)((()=>{if(!h&&!0===o.have_subscription&&"newCard"===t.cards&&void 0!==i?.environment&&"PROD"===i?.environment)return l((0,a.__)("For subscriptions you must click on the checkbox save card","tilopay")),S((e=>[...e,"checkbox-control-tpay"])),void f(!0);S((e=>e.filter((e=>"checkbox-control-tpay"!==e)))),l(void 0),l(void 0),n((e=>({...e,tpay_save_card:h?"on":"off"})))}),[k,b,h]),(0,e.useEffect)((()=>{"000"!==t.tlpy_cvv&&""!==t.tlpy_cvv&&(N()?R():n((e=>{var n,a;return{...e,token_hash_card_tilopay:null!==(n=t.tlpy_cc_number)&&void 0!==n?n:"NA",token_hash_code_tilopay:null!==(a=t.tlpy_cvv)&&void 0!==a?a:"NA"}})))}),[t.tlpy_cc_number,t.tlpy_cvv,t.tlpy_cc_expiration_date]);const N=()=>"PROD"===t.tpay_env&&!1===t.pay_sinpemovil_tilopay&&("amex"===t.card_type_tilopay?"newCard"!==t.cards&&""!==t.cards?null!=t.tlpy_cvv&&4===t.tlpy_cvv.length:null!=t.tlpy_cc_number&&t.tlpy_cc_number.length>=16&&null!=t.tlpy_cc_expiration_date&&t.tlpy_cc_expiration_date.length>=4&&null!=t.tlpy_cvv&&4===t.tlpy_cvv.length:"newCard"!==t.cards&&""!==t.cards?null!=t.tlpy_cvv&&3===t.tlpy_cvv.length:null!=t.tlpy_cc_number&&t.tlpy_cc_number.length>=16&&null!=t.tlpy_cc_expiration_date&&t.tlpy_cc_expiration_date.length>=4&&null!=t.tlpy_cvv&&3===t.tlpy_cvv.length),R=async()=>{const{cipherCardNumber:e,cipherCvv:a}=await makeCipherData(t);console.log({cipherCardNumber:e,cipherCvv:a,paymentData:t}),null!==e&&null!==a?n((t=>({...t,token_hash_card_tilopay:e,token_hash_code_tilopay:a}))):null!==a&&void 0===e&&(t.token_hash_code_tilopay=a,n((e=>({...e,token_hash_code_tilopay:a}))))};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"payFormTilopay"},w.length>0&&(0,e.createElement)("div",{className:"form-row form-row-wide",style:{marginTop:"10px"}},(0,e.createElement)("label",{htmlFor:"cards"},"Tarjetas guardadas"),(0,e.createElement)("select",{name:"cards",id:"cards",className:"select wc-credit-card-form-card-select",onChange:({target:e})=>{const{value:t}=e;let a="";"newCard"===t&&""===t||(t.substring(0,4),a=payform.parseCardType(t),T(t)),n((e=>({...e,cards:t,card_type_tilopay:a,tlpy_cvv:""})))},style:{height:50},value:P},(0,e.createElement)("option",{value:"",desabled:"true"},"Seleccionar tarjeta"),w.map(((t,n)=>(0,e.createElement)("option",{key:n,value:t.id.split(":")[0]},t.name))),(0,e.createElement)("option",{value:"newCard"},(0,a.__)("Pay with another card","tilopay")))),(0,e.createElement)("div",{className:"form-row form-row-wide"},"newCard"===t.cards&&(0,e.createElement)("div",{className:"wc-block-components-text-input wc-block-components-address-form__tlpy_cc_number "+(p?"is-active":"")},(0,e.createElement)(g,{maskGenerator:y("9999 9999 9999 9999"),type:"tel",id:"tlpy_cc_number",name:"tlpy_cc_number",inputMode:"numeric",autoComplete:"off",autoCorrect:"no",autoCapitalize:"no",spellCheck:"no",value:t.tlpy_cc_number,onChange:e=>{d(""!==e);let t=payform.parseCardType(e);switch(n((n=>({...n,tlpy_cc_number:e,card_type_tilopay:t}))),t){case"visa":C("visa.svg");break;case"mastercard":C("mastercard.svg");break;case"amex":C("american_express.svg");break;default:C("flat_icon_tilopay.png")}},style:{backgroundImage:"url("+o.tpayPluginUrl+"assets/images/"+x+")",backgroundRepeat:"no-repeat",backgroundPosition:"right 0.6180469716em center",backgroundSize:"31px 20px"}}),(0,e.createElement)("label",{htmlFor:"tlpy_cc_number"},"Número de Tarjeta")),(0,e.createElement)("div",{className:"'wc-block-components-address-form__expiration-cvv'",style:{display:"flex"}},"newCard"===t.cards&&(0,e.createElement)("div",{className:`wc-block-components-text-input wc-block-components-address-form__tlpy_cc_expiration_date ${u?"is-active":""} ${M.includes("tlpy_cc_expiration_date")?"has-error":""}`,style:{flex:1,marginRight:"10px"}},(0,e.createElement)(g,{maskGenerator:y("99 / 99"),type:"tel",id:"tlpy_cc_expiration_date",name:"tlpy_cc_expiration_date",inputMode:"numeric",autoComplete:"off",autoCorrect:"no",autoCapitalize:"no",spellCheck:"no",value:t.tlpy_cc_expiration_date,onChange:e=>{m(""!==e),n((t=>({...t,tlpy_cc_expiration_date:e})))},onBlur:()=>{const e=t.tlpy_cc_expiration_date,n=e.substring(0,2),o=e.substring(2);if(e.length>2){const e=new Date,t=e.getFullYear(),r=e.getMonth()+1,i=t%100;let s=!isNaN(n)&&n>=1&&n<=12;o<=i&&""!==o&&(s=n>r);const c=!isNaN(o)&&o>=i;s&&c?(S((e=>e.filter((e=>"tlpy_cc_expiration_date"!==e)))),l(void 0)):(l((0,a.__)("Please enter a valid expiration date.","tilopay")),S((e=>[...e,"tlpy_cc_expiration_date"])))}}}),(0,e.createElement)("label",{htmlFor:"tlpy_cc_expiration_date"},"Fecha de Expiración")),(0,e.createElement)("div",{className:`wc-block-components-text-input wc-block-components-address-form__tlpy_cvv ${v?"is-active":""} ${M.includes("tlpy_cvv")?"has-error":""}`,style:{flex:1}},(0,e.createElement)(g,{maskGenerator:y("9999"),id:"tlpy_cvv",name:"tlpy_cvv",type:"tel",autoComplete:"off",autoCorrect:"no",autoCapitalize:"no",spellCheck:"no",maxLength:"amex"===t.card_type_tilopay?4:3,value:t.tlpy_cvv,onChange:e=>{_(""!==e),n((t=>({...t,tlpy_cvv:e})))},onBlur:()=>{"amex"===t.card_type_tilopay&&4!==t.tlpy_cvv.length?(l((0,a.__)("Please enter a CVV valid for AMEX cards.","tilopay")),S((e=>[...e,"tlpy_cvv"]))):"amex"!==t.card_type_tilopay&&3!==t.tlpy_cvv.length?(l((0,a.__)("Please enter a valid CVV for","tilopay")+" "+t.card_type_tilopay),S((e=>[...e,"tlpy_cvv"]))):(S((e=>e.filter((e=>"tlpy_cvv"!==e)))),l(void 0))}}),(0,e.createElement)("label",{htmlFor:"tlpy_cvv"},"CVV"))),"newCard"===t.cards&&"PROD"===t.tpay_env&&(0,e.createElement)(s.CheckboxControl,{id:"checkbox-control-tpay",className:M.includes("checkbox-control-tpay")?"has-error":"",checked:h,onChange:f,desabled:o.have_subscription&&h?"disabled":null},"Guardar tarjeta"))))},k=({selectedPaymentMethod:t,setSelectedPaymentMethod:n,initSdkSettings:o,checkoutData:l,paymentData:r,sdkInitResponse:i,activeModal:s,setActiveModal:c})=>{const{sinpemovil:p}=i;return(0,e.useEffect)((()=>{s&&setTimeout((async()=>{await sinpeMovilEventTrigger()}),1e3)}),[s]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{id:"tilopay-m1",className:"tilopay-modal-container "+(s?"active":"")},(0,e.createElement)("div",{className:"tilopay-overlay","data-modal":"close"}),(0,e.createElement)("div",{className:"tilopay-modal"},(0,e.createElement)("h3",null,(0,a.__)("Pay with SINPE Móvil","tilopay")),(0,e.createElement)("p",null,(0,a.__)("To make the payment with SINPE Móvil, you must make sure to make the payment in the following way:","tilopay")," ",(0,e.createElement)("br",null),(0,a.__)("Telephone:","tilopay")," ",(0,e.createElement)("strong",{id:"tilopay-sinpemovil-number"},r.tlpy_sinpemovil_number),(0,e.createElement)("br",null),(0,a.__)("Exact amount:","tilopay")," ",(0,e.createElement)("strong",null," ",l.currency," ")," ",(0,e.createElement)("strong",{id:"tilopay-sinpemovil-amount"},p.amount),(0,e.createElement)("br",null),(0,a.__)("Specify in the description:","tilopay")," ",(0,e.createElement)("strong",{id:"tilopay-sinpemovil-code"},p.code),(0,e.createElement)("br",null)),(0,e.createElement)("div",{className:"tilopay-btn-group"},(0,e.createElement)("button",{type:"button",className:"button btn-tilopay-close-modal",onClick:()=>{c(!1),n(void 0)},style:{marginRight:"10px"}},(0,a.__)("Cancel","tilopay")),(0,e.createElement)("button",{type:"button",id:"process-tilopay",className:"button alt process-sinpemovil-tilopay loading",desabled:"true"},(0,a.__)("Waiting payment","tilopay"))))))},w=({type:t,message:n,link:a})=>(0,e.createElement)("div",{className:"wc-block-components-notices"},(0,e.createElement)("div",{className:`wc-block-store-notice wc-block-components-notice-banner ${t}`},(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,e.createElement)("path",{d:"M12 3.2c-4.8 0-8.8 3.9-8.8 8.8 0 4.8 3.9 8.8 8.8 8.8 4.8 0 8.8-3.9 8.8-8.8 0-4.8-4-8.8-8.8-8.8zm0 16c-4 0-7.2-3.3-7.2-7.2C4.8 8 8 4.8 12 4.8s7.2 3.3 7.2 7.2c0 4-3.2 7.2-7.2 7.2zM11 17h2v-6h-2v6zm0-8h2V7h-2v2z"})),(0,e.createElement)("div",{className:"wc-block-components-notice-banner__content"},(0,e.createElement)("div",null,null!=n?n:"Oops! Something went wrong"," ",a&&(0,e.createElement)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer"},a.text))))),E=()=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{id:"responseTilopay"}),(0,e.createElement)("div",{className:"payFormTilopay",style:{display:"none"}},(0,e.createElement)("div",{className:"form-row form-row-wide",id:"selectCard",style:{display:"none"}},(0,e.createElement)("label",null,"Tarjetas guardadas"),(0,e.createElement)("select",{name:"cards",id:"cards"},(0,e.createElement)("option",{value:"",desabled:"true"},"Seleccionar tarjeta"))),(0,e.createElement)("div",{className:"form-row form-row-wide",id:"selectMethods",style:{display:"none"}},(0,e.createElement)("label",null,"Methdos"),(0,e.createElement)("select",{name:"tlpy_payment_method",id:"tlpy_payment_method"},(0,e.createElement)("option",{value:"",desabled:"true"},"Seleccionar método"))),(0,e.createElement)("input",{type:"hidden",id:"tlpy_cc_number",name:"tlpy_cc_number",inputMode:"numeric",autoComplete:"off",autoCorrect:"no",autoCapitalize:"no",spellCheck:"no",value:""}),(0,e.createElement)("input",{type:"hidden",id:"tlpy_cc_expiration_date",name:"tlpy_cc_expiration_date",inputMode:"numeric",autoComplete:"off",autoCorrect:"no",autoCapitalize:"no",spellCheck:"no",value:""}),(0,e.createElement)("input",{id:"tlpy_cvv",name:"tlpy_cvv",inputMode:"numeric",autoComplete:"off",autoCorrect:"no",autoCapitalize:"no",spellCheck:"no",type:"hidden",maxLength:"4",value:""}))),x=(0,r.getSetting)("tilopay_data",{}),{sdk_init_payload:C,tpay_key:M}=x,S=(0,a.__)("Tilopay","tilopay"),P=(0,l.decodeEntities)(x.title)||S,T=t=>{if("yes"!==x.tpay_redirect){var n,o,l;const[r,s]=(0,e.useState)(void 0),p=((0,c.select)("wc/store/payment").getActivePaymentMethod(),(0,c.select)("wc/store/payment").getPaymentResult()),d=C.wooSessionTpay,u=((0,c.select)("wc/store/checkout").getRedirectUrl(),(0,c.select)("wc/store/checkout").getCheckoutStatus()),[m,y]=(0,e.useState)(void 0),[v,_]=(0,e.useState)("otra"),[h,f]=(0,e.useState)("flex"),[g,M]=(0,e.useState)(!1),[S,P]=(0,e.useState)({tlpy_cc_number:"",tlpy_cc_expiration_date:"",tlpy_cvv:"",cards:"newCard",woo_session_tilopay:C.wooSessionTpay,pay_sinpemovil_tilopay:!1,tpay_save_card:"off",tpay_can_make_payment:!0,process_with_apple_pay:0}),[T,N]=(0,e.useState)(void 0),[R,D]=(0,e.useState)(void 0),[V,A]=(0,e.useState)(void 0),[O,I]=(0,e.useState)(!1),[B,F]=(0,e.useState)(!1),{eventRegistration:z,emitResponse:j,billing:G,cartData:L,onSubmit:U,components:W}=t,{onPaymentSetup:$,onCheckoutFail:q,onCheckoutSuccess:H,onCheckoutValidation:K,onCheckoutValidationBeforeProcessing:Y}=z,{noticeContexts:Z,responseTypes:J}=j,Q=G.cartTotal.value/100,X=G.currency.code,{first_name:ee,last_name:te,company:ne,address_1:ae,address_2:oe,city:le,state:re,postcode:ie,country:se,email:ce,phone:pe}=G.billingAddress,de=void 0!==L.cartItems.find((e=>"subscription"===e.type)),{setValidationErrors:ue,clearValidationError:me}=(0,c.useDispatch)("wc/store/validation");let ye={token:null!==(n=C.token)&&void 0!==n&&n,currency:X,language:null!==(o=C.language)&&void 0!==o?o:"EN",amount:null!=Q?Q:0,amount_sinpe:Q>0?Math.ceil(Q):0,billToFirstName:ee,billToLastName:te,billToAddress:ae,billToAddress2:oe,billToCity:le,billToState:re,billToZipPostCode:ie,billToCountry:se,billToTelephone:pe,billToEmail:null!=ce?ce:"",orderNumber:d,capture:"yes"===x.tpay_capture?1:0,redirect:x.tpay_checkout_redirect,subscription:0,platform:"woocommerce",platform_reference:C.platform_reference,userDataIn:null!==(l=C.userDataIn)&&void 0!==l?l:0,urlTilopay:C.urlTilopay,Key:x.tpay_key,tpayPluginUrl:C.tpayPluginUrl,wooSessionTpay:C.wooSessionTpay};const{applePayIntegrationTilopay:ve,placeHolderBtnWooCommerceOverride:_e}=((e,t,n,a,o,l)=>({placeHolderBtnWooCommerceOverride:async()=>{var e=document.getElementById("apple_pay_button_style_tpay");e&&e.remove();const t=document.querySelector(".wc-block-components-checkout-place-order-button"),n=document.querySelector(".wc-block-components-button__text");if(1===o.apple_pay&&"applepay"===o.type){var a=document.createElement("style");a.id="apple_pay_button_style_tpay",a.appendChild(document.createTextNode("\n.apple-pay-button {\n    display: inline-block;\n    width: 100%;\n    height: 53px;\n    cursor: pointer;\n    margin-top: 15px;\n    -webkit-appearance: -apple-pay-button;\n    --apple-pay-button-width: 100%;\n    --apple-pay-button-height: 50px;\n    --apple-pay-button-border-radius: 0px;\n    --apple-pay-button-padding: 0px 0px;\n    --apple-pay-button-box-sizing: content-box;\n}\n\n.buttonApplePayProgress {\n    background: #4C5562;\n    border: 1px solid #4C5562;\n    color: #fff;\n    border-radius: 8px;\n    padding: 10px 105px;\n    width: 100%;\n    position: relative;\n    pointer-events: none;\n    display: inline-block;\n    margin-top: 15px;\n    -webkit-appearance: -apple-pay-button;\n    --apple-pay-button-width: 100%;\n    --apple-pay-button-height: 50px;\n    --apple-pay-button-border-radius: 0px;\n    --apple-pay-button-padding: 0px 0px;\n    --apple-pay-button-box-sizing: content-box;\n}\n")),document.head.appendChild(a),t&&(t.classList.add("apple-pay-button"),t.style.height="53px"),n&&(n.style.display="none")}else n&&(n.style.display="block"),t&&n.classList.remove("apple-pay-button")},applePayIntegrationTilopay:async()=>{if(t?.applePaySupported&&1===o.apple_pay&&"applepay"===o.type)try{const e=await processSDKWithApplePay();return e?JSON.stringify(e):e}catch(e){console.error("Error procesando el pago con Apple Pay:",e),a(e),l(!1)}return!1}}))(0,R,0,N,m,F);(0,e.useEffect)((()=>{void 0!==m&&"card"===m?.type&&M(!0),"function"==typeof cleanSinpeMovilInterval?cleanSinpeMovilInterval():console.log("cleanSinpeMovilInterval is undefined.")}),[m]),(0,e.useEffect)((()=>{void 0!==m&&_e()}),[m,u]),(0,e.useEffect)((()=>{}),[me,ue,m]),(0,e.useEffect)((()=>{s({order_id:d,first_name:ee,last_name:te,company:ne,address_1:ae,address_2:oe,city:le,state:re,zip_code:ie,country:se,email:ce,phone:pe,currency:X,cart_total:Q,have_subscription:de,checkout_url:x.tpay_checkout_redirect,tpayPluginUrl:C.tpayPluginUrl})}),[]),(0,e.useEffect)((()=>{setTimeout((async()=>{null!==ce&&ce!==C.email&&"sinpemovil"!==S.pay_sinpemovil_tilopay&&await he()}),100)}),[ce]);const he=async()=>{if(f("flex"),!1===ye.token)N((0,a.__)("There seems to be an issue with this website's integration with Tilopay, please inform the seller to complete your purchase.","tilopay"));else{const e=await getSdkInit(ye),{sinpemovil:t,environment:n,message:a}=e;"Success"==a?D(e):void 0!==a&&""!==a&&N(a)}f("none")};return(0,e.useEffect)((()=>{const e=$((async()=>{if(closeTilopayErrorMessage(),null!==S&&Object.keys(S).length>0){if(S.tpay_woo_checkout_nonce=x.tpay_nonce,!B&&void 0!==m&&"applepay"===m.type){const e=await ve();if(!1===e)return await he(),{type:j.responseTypes.ERROR,message:(0,a.__)("Process payment with Apple Pay failed. Please try again, if the error persists, refresh the page.","tilopay")};S.payload_apple_pay=e,S.process_with_apple_pay=1,F(!0)}if(0===S.process_with_apple_pay){if("PROD"===S.tpay_env&&!0===S.pay_sinpemovil_tilopay&&!0===r.have_subscription?N((0,a.__)("You cannot pay subscriptions with SINPE Movíl, please pay with a credit or debit card","tilopay")):N(void 0),"PROD"==S.tpay_env&&!1===S.pay_sinpemovil_tilopay){S.tlpy_cc_number=S.tlpy_cc_number?"...-"+String(S.tlpy_cc_number.slice(-4)):"";let e=!0;if("newCard"!==S.cards&&""!==S.cards?e=""===S.token_hash_code_tilopay:"newCard"===S.cards&&""!==S.cards&&(e=""===S.token_hash_card_tilopay||""===S.token_hash_code_tilopay),e)return{type:j.responseTypes.ERROR,message:(0,a.__)("Check credit or debit card details","tilopay")}}if("PROD"!==S.tpay_env&&!0===r.have_subscription?N((0,a.__)("Subscriptions payment is not allowed in test environment.","tilopay")):N(void 0),void 0===S.tlpy_payment_method)return{type:j.responseTypes.ERROR,message:"Not payment method selected."}}return{type:j.responseTypes.SUCCESS,meta:{paymentMethodData:S}}}return{type:j.responseTypes.ERROR,message:"There was an error with Tilopay."}}));return()=>{e()}}),[j.responseTypes.ERROR,j.responseTypes.SUCCESS,$,S]),(0,e.useEffect)((()=>{const e=q((async()=>(void 0!==m&&_e(),!0===S.pay_sinpemovil_tilopay?{type:j.responseTypes.FAIL,message:"Sinpe movil payment is not supported by Tilopay."}:{type:j.responseTypes.FAIL,message:"There was an error with Tilopay."})));return()=>{e()}}),[j.responseTypes.FAIL,q]),(0,e.useEffect)((()=>{if(p){const{paymentStatus:t,message:n,redirectUrl:a,paymentDetails:o}=p;if(o){var e;const{result:t,messages:n}=o;let a=null!==(e=o?.order_id)&&void 0!==e?e:void 0;null!=a&&null!=a&&(A(a),setTimeout((()=>{I(!0)}),1e3)),"failure"===t&&n&&(N(n),void 0!==m&&_e())}}}),[p]),(0,e.useEffect)((()=>{V&&(ye.orderNumber=V,ye.have_order_id=!0,setTimeout((async()=>{await he()}),100))}),[V]),(0,e.createElement)(e.Fragment,null,T&&(0,e.createElement)(w,{type:"is-error",message:T}),(0,e.createElement)("div",{className:"wc-block-components-radio-control-accordion-content"},(0,e.createElement)("div",{id:"loaderTpay",payformtilopay:"",style:{display:h}},(0,e.createElement)("div",{className:"spinnerTypayInit"})),void 0!==R?.environment&&"PROD"!==R?.environment&&(0,e.createElement)(w,{type:"is-error",message:(0,a.__)("TEST MODE ENABLED. In test mode, you can use the card numbers listed in","tilopay"),link:{text:"Admin Tilopay",url:"http://admin.tilopay.com/"}}),S.tpay_can_make_payment?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"payFormTilopay"},void 0===R&&"none"==h&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,(0,a.__)("Oops! Something went wrong.","tilopay")),(0,e.createElement)("button",{type:"button",id:"call-tilopay",className:"button alt process-sinpemovil-tilopay",onClick:he},(0,a.__)("Try again","tilopay"))),void 0!==R&&(0,e.createElement)("div",{className:"form-row form-row-wide"},(0,e.createElement)(i,{initSdkSettings:ye,sdkInitResponse:R,selectedPaymentMethod:m,setSelectedPaymentMethod:y,paymentData:S,setPaymentData:P,checkoutData:r,setPaymentError:N,paymentError:T,activeModal:O,setActiveModal:I})),"card"===m?.type&&(0,e.createElement)(b,{paymentData:S,setPaymentData:P,checkoutData:r,setPaymentError:N,paymentError:T,sdkInitResponse:R}),"sinpemovil"===m?.type&&(de?(0,e.createElement)("div",{className:"tpayEnvAlert",style:{marginTop:"15px"}},(0,e.createElement)("span",{id:"environment"},(0,a.__)("No puede pagar suscripciones con SINPE Móvil, por favor pague con una tarjeta de crédito o débito","tilopay"))):void 0!==V?(0,e.createElement)(k,{selectedPaymentMethod:m,setSelectedPaymentMethod:y,initSdkSettings:ye,checkoutData:r,paymentData:S,sdkInitResponse:R,activeModal:O,setActiveModal:I}):(0,e.createElement)(w,{type:"is-success",message:(0,a.__)("The payment instructions with SINPE Móvil will be shown on the next screen.","tilopay")})))):(0,e.createElement)(w,{type:"is-error",message:(0,a.__)("There seems to be an issue with this website's integration with Tilopay, please inform the seller to complete your purchase.","tilopay")+"processor : 1"})),!1===g&&(0,e.createElement)(E,null))}},N={paymentMethodId:x.id,name:x.id,label:(0,e.createElement)((t=>{const{PaymentMethodLabel:n}=t.components;return(0,e.createElement)(n,{text:P})}),null),content:(0,e.createElement)(T,null),edit:(0,e.createElement)(T,null),canMakePayment:()=>!0,ariaLabel:P,supports:{features:x.supports}};(0,o.registerPaymentMethod)(N)})()})();